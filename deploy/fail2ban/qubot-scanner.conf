[Definition]
# Fail2ban filter for scanner detection via nginx access logs
# Matches vulnerability scanner patterns

# Match scanner patterns in nginx combined log format
# Format: IP - - [timestamp] "METHOD /path HTTP/x.x" status size "referer" "user-agent"
# Match 3xx/4xx/5xx - exclude only 2xx success
# 3xx included because redirects to .env/.git are still scanner probes
failregex = ^<HOST> -.*"(?:GET|POST|PUT|DELETE|HEAD|OPTIONS) /(?:.*\.(?:php\d?|phtml|htr|htm|shtm|shtml|asp|aspx|cfm|cgi|pl|jsp|jspx)|iisadmpwd|iisadmin|phpmyadmin|wp-admin|wp-login|wp-content|wp-includes|\.env|\.git|\.svn|\.htaccess|administrator|admin\.php|login\.php|setup\.php|config\.php|shell|c99|r57|webshell|eval-stdin|phpunit|xmlrpc|niet)\S* HTTP/\d\.\d" [345]\d\d

ignoreregex =

# Nginx log timestamp format
datepattern = %%d/%%b/%%Y:%%H:%%M:%%S %%z
