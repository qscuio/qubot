<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Pro Stock Chart</title>

    <!-- External Libraries -->
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- CSS Modules -->
    <link rel="stylesheet" href="./css/variables.css">
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/responsive.css">
</head>

<body>
    <div class="header">
        <!-- Row 1: Stock Name & Code (Centered) -->
        <div class="header-row-title">
            <span class="stock-name" id="name">--</span>
            <span class="stock-code" id="code">--</span>
        </div>

        <!-- Row 2: Price & Change -->
        <div class="header-row-price">
            <span class="price-curr" id="price">--</span>
            <div class="price-change flat" id="change">--%</div>
        </div>

        <!-- Row 3: Actions (Search, Add, Watchlist, Chips) -->
        <div class="header-row-actions">
            <button class="t-btn xs" id="btn-home" title="Home">üè†</button>
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="search-input" placeholder="Search" autocomplete="off">
                <div id="search-results" class="search-results-dropdown"></div>
            </div>

            <button class="t-btn xs" id="btn-watchlist" title="Add to Watchlist">‚òÜ</button>

            <!-- Watchlist Dropdown -->
            <div class="watchlist-container">
                <button class="t-btn xs" id="btn-my-list" title="My Watchlist">Ëá™ÈÄâ ‚ñæ</button>
                <div id="watchlist-dropdown" class="watchlist-dropdown">
                    <div class="watchlist-header">
                        <span>ÊàëÁöÑËá™ÈÄâ</span>
                        <button class="close-btn-sm" id="close-watchlist">√ó</button>
                    </div>
                    <div id="watchlist-items" class="watchlist-items">
                        <!-- Items injected here -->
                        <div class="wl-loading">Loading...</div>
                    </div>
                </div>
            </div>

            <button class="t-btn xs" id="chips-toggle" style="display: none;">Chips</button>
        </div>

        <!-- Row 4: Stats -->
        <div class="header-row-stats">
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="stat-label">Amp</span>
                    <span class="stat-val" id="amplitude">--%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Turn</span>
                    <span class="stat-val" id="turnover">--%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">VR</span>
                    <span class="stat-val" id="vol-ratio">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Vol</span>
                    <span class="stat-val" id="vol-stat">--</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Banner -->
    <div class="action-banner" id="action-banner">
        <div class="action-signal">
            <span class="action-badge hold" id="action-badge">HOLD</span>
            <div>
                <div class="action-text" id="action-text">Analyzing...</div>
                <div class="action-time" id="action-time">--</div>
            </div>
        </div>
    </div>

    <!-- Sector Banner -->
    <div class="sector-banner" id="sector-banner" style="display: none;">
        <div class="sector-scroll-container" id="sector-container">
            <!-- Tags injected here -->
        </div>
    </div>



    <!-- Toolbar -->
    <div class="toolbar">
        <div class="group">
            <button class="t-btn active" data-period="daily">Day</button>
            <button class="t-btn" data-period="weekly">Week</button>
            <button class="t-btn" data-period="monthly">Month</button>
        </div>

        <div class="group">
            <button class="t-btn active" id="btn-ma">MA</button>
            <button class="t-btn" id="btn-boll">BOLL</button>
        </div>

        <div class="group">
            <button class="t-btn" id="btn-log">Log</button>
        </div>

        <div class="group">
            <button class="t-btn active" data-subchart="VOL">VOL</button>
            <button class="t-btn" data-subchart="MACD">MACD</button>
            <button class="t-btn" data-subchart="KDJ">KDJ</button>
            <button class="t-btn" data-subchart="RSI">RSI</button>
        </div>

        <button class="t-btn xs active" id="btn-signals">Signals</button>
        <button class="t-btn xs active" id="btn-lines" data-action="lines">Lines</button>
        <button class="t-btn xs active" id="btn-chips">Chips</button>

        <div class="spacer"></div>
        <button class="t-btn xs" id="btn-landscape" style="font-size: 16px;" title="Rotate Screen">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 4v16M7 4v16M3 8h18M3 16h18" />
                <path d="M21 12l-4-4M21 12l-4 4" stroke-dasharray="0" />
            </svg>
            <span style="display:none">‚ü≤</span>
        </button>
        <button class="theme-toggle" id="theme-btn">üåô</button>
    </div>

    <!-- Floating Navigation -->
    <div id="floating-nav" class="floating-nav" style="display: none;">
        <button class="nav-btn prev" id="float-btn-prev">
            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </button>
        <button class="nav-btn next" id="float-btn-next">
            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>
    </div>

    <!-- Main Content -->
    <div class="content-area">
        <div class="chart-section">
            <div id="loading" class="overlay">
                <div class="spinner"></div>
            </div>

            <div id="main-chart">
                <div class="legend-floating" id="main-legend">
                    <div class="leg-row" style="margin-bottom: 4px;">
                        <span class="leg-item" style="color: var(--text-muted); font-size: 10px;" id="date-range">-- ~
                            --</span>
                    </div>
                    <div class="leg-row">
                        <span class="leg-item"><span class="leg-lbl">O</span><span class="leg-val"
                                id="l-o">--</span></span>
                        <span class="leg-item"><span class="leg-lbl">H</span><span class="leg-val"
                                id="l-h">--</span></span>
                        <span class="leg-item"><span class="leg-lbl">L</span><span class="leg-val"
                                id="l-l">--</span></span>
                        <span class="leg-item"><span class="leg-lbl">C</span><span class="leg-val"
                                id="l-c">--</span></span>
                    </div>
                    <!-- MA Legend -->
                    <div class="leg-row" id="ma-legend">
                        <span class="leg-item c-ma5">MA5:<span class="leg-val c-ma5" id="l-ma5">--</span></span>
                        <span class="leg-item c-ma10">MA10:<span class="leg-val c-ma10" id="l-ma10">--</span></span>
                        <span class="leg-item c-ma20">MA20:<span class="leg-val c-ma20" id="l-ma20">--</span></span>
                    </div>
                </div>
            </div>

            <div id="sub-chart">
                <div class="legend-floating">
                    <div class="leg-row" id="sub-legend">
                        <!-- Dynamic Subchart Legend -->
                    </div>
                </div>
            </div>
        </div>

        <div class="backdrop" id="backdrop"></div>

        <div class="side-panel" id="side-panel">
            <div class="panel-header">
                <span>Chip Distribution</span>
                <span id="chip-date" style="font-weight: 400; color: var(--text-muted);">--</span>
                <button class="close-btn">√ó</button>
            </div>
            <div id="chip-chart-area" style="flex: 1; position: relative; overflow: hidden;">
                <canvas id="chip-canvas"
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
            </div>
            <div class="chip-stats">
                <div class="chip-row">
                    <span style="color:var(--text-muted)">Profit Ratio</span>
                    <span class="chip-val" id="p-ratio" style="color:var(--up-color)">--%</span>
                </div>
                <div class="chip-row">
                    <span style="color:var(--text-muted)">Avg Cost</span>
                    <span class="chip-val" id="avg-cost">--</span>
                </div>
                <div class="chip-row">
                    <span style="color:var(--text-muted)">Concentration</span>
                    <span class="chip-val" id="conc">--%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Entry Point -->
    <script type="module" src="./js/main.js"></script>
</body>

</html>